# 计算机网络复习笔记
## 第一章 概述
### 因特网发展的三个阶段
1. 第一阶段是从单个网络 ARPANET 向互联网发展的过程

2. 第二阶段的特点是建成了**三级结构的因特网**

3. 第三阶段的特点是逐渐形成了**多层次 ISP 结构的因特网**

### 三种交换方式在数据传送阶段的主要特点
|名称|特点|
|:---|:---|
|电路交换|整个报文的比特流连续地从源点直达终点，好像在一个管道中传送|
|报文交换|整个报文先传送到相邻结点，全部存储下来后查找转发表，转发到下一个结点|
|分组交换|单个分组（这只是整个报文的一部分）传送到相邻结点，存储下来后查找转发表，转发到下一个结点|

### 计算机网络的类别
- 广域网（Wide Area Network，WAN）

- 城域网（Metropolitan Area Network，MAN）

- 局域网（Local Area Network，LAN）

- 个人区域网（Personal Area Network，PAN）

### 时延的计算
1. **发送时延**

	**发送时延（transmission delay）**是主机或路由器发送数据帧所需要的时间，也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。因此发送时延也叫作“**传输时延**”

	发送时延 = 数据帧长度（b）/ 发送速率（b/s）

2. **传播时延**

	**传播时延（propagation delay）**是电磁波在信道中传播一定的距离需要花费的时间

	传播时延 = 信道长度（m）/ 电磁波在信道上的传播速率（m/s）

3. **处理时延**

	主机或路由器在收到分组时要花费一定的时间进行处理，例如分析分组的首部、从分组中提取数据部分、进行差错检验或查找适当的路由等等，这就产生了**处理时延**

4. **排队时延**

	分组在经过网络传输时，要经过许多路由器。但分组在进入路由器后要先在输入队列中排队等待处理。在路由器确定了转发接口后，还要在输出队列中排队等待转发。这就产生了排队时延。

***总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延***

### everything over IP 和 IP over everything
- everything over IP：TCP/IP 协议可以为各式各样的应用提供服务

- IP over everything：允许 IP 协议在各式各样的网络构成的互联网上运行

## 第二章 物理层
### 信号的分类
1. **模拟信号**，或**连续信号**——代表消息的参数的取值是连续的

2. **数字信号**，或**离散信号**——代表消息的参数的取值是离散的

### 通信的双方信息交互的方式
1. 单向通信

	又称**单工通信**，即只能有一个方向的通信而没有反方向的交互。无线点广播或有有线电广播以及电视广播就属于这种类型

2. 双向交替通信

	又称**半双工通信**，即通信的双方都可以发送信息，但不能双方同时发送（当然也就不能同时接收）。这种通信方式是一方发送另一方接受，过一段时间后再反过来

3. 双向同时通信

	又称**全双工通信**，即通信的双方可以同时发送和接受信息

### 调制的分类
1. **基带调制**，又称为**编码（coding）**，仅仅对基带信号的波形进行变换，使它能够与信道特性相适应。变换后的信号仍然是基带信号

2. **带通调制**，使用**载波（carrier）**进行调制，把基带信号的频率范围搬移到较高的频段，并转换为模拟信号，这样就能够更好地在模拟信道中传输。经过载波调制后的信号称为**带通信号**

### 引导型传输媒体
1. 双绞线

2. 同轴电缆

3. 光缆（带宽最宽）

### 练习题
1. 解释以下名词：数据、信号、基带信号、带通信号、码元、单工通信、半双工通信、全双工通信

	**答：**

	|名词|解释|
	|:---|:---|
	|数据|是运送信息的实体|
	|信号|是数据的电气的或电磁的表现|
	|码元（code）|在使用时间域（或简称为时域）的波形表示数字信号时，代表不同离散数值的基本波形|
	|单工通信|即只有一个方向的通信而没有反方向的交互|
	|半双工通信|即通信和双方都可以发送信息，但不能双方同时发送（当然也不能同时接收）。这种通信方式是一方发送另一方接收，过一段时间再反过来|
	|全双工通信|即通信的双方可以同时发送和接收信息|
	|基带信号|即基本频带信号，来自信源的信号|
	|带通信号|把基带信号经过载波调制后的信号|

2. 共有四个站点进行码分多址 CDMA 通信。四个站的码片序列为：

	A:(-1 -1 -1 +1 +1 -1 +1 +1)

	B:(-1 -1 +1 -1 +1 +1 +1 -1)

	C:(-1 +1 -1 +1 +1 +1 -1 -1)

	D:(-1 +1 -1 -1 -1 -1 +1 -1)

	现在收到这样的码片序列 S:(-1 +1 -3 +1 -1 -3 +1 +1)。问哪个站发送数据了？发送的是 1 还是 0 ？

	**答：**

	S · A = (+1 -1 +3 +1 -1 +3 +1 +1) / 8 = 1	因此 A 发送了 1

	S · B = (+1 -1 -3 -1 -1 -3 +1 -1) / 8 = -1	因此 B 发送了 0

	S · C = (+1 +1 +3 +1 -1 -3 -1 -1) / 8 = 0	因此 C 没有发送

	S · D = (+1 +1 +3 -1 +1 +3 +1 -1) / 8 = 1	因此 D 发送了 1

## 第三章 数据链路层
### 三个基本问题
1. **封装成帧**

	**封装成帧（framing）**就是在一段数据的前后分别添加首部和尾部，这样就构成了一个**帧**

	补充：

	一个帧的帧长等于帧的数据部分长度加上帧首部和帧尾部的长度

	每一种链路层协议都规定了所能传送的帧的**数据部分**长度上限——**最大传送单元MTU（Maximum Transfer Unit）**

2. **透明传输**

	**透明**是指某一个实际存在的事物看起来却好像不存在一样，“在数据链路层透明传送数据”表示无论什么样的比特组合的数据都能够通过这个数据链路层

	具体做法：发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符“ESC”（其十六进制编码是 1B，二进制是 00011011）。而在接收端的数据链路层在把数据送往网络层之前删除这个插入的转义字符。这种方法称为**字节填充（byte stuffing）**或**字符填充（character stuffing）**

3. **差错检测**

	为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。目前广泛使用**循环冗余检验CRC（Cyclic Redundancy Check）**的检错技术

### 练习题
1. 要发送的数据为 1101011011，采用 CRC 的生成多项式是 P(X)=X<sup>4</sup> + X + 1

	（1）试求应添加在数据后面的余数

	（2）数据在传输过程中最后一个 1 变成了 0，问接收端能否发现？

	（3）若数据在传输过程中最后两个 1 都变成了 0，问接收端能否发现？

	（4）采用 CRC 检验后，数据链路层的传输是否就变成了可靠的传输？

	**答：**

	（1）做二进制除法 11010110110000 除以 10011 的余数为 1110

	（2）做二进制除法 11010110101110 除以 10011，得余数不为 0，则接收端可以发现

	（3）做二进制除法 11010110001110 除以 10011，得余数不为 0，则接收端可以发现

	（4）仅仅采用了 CRC 检验，缺少重传机制，数据链路层的传输还不是可靠的传输

2. 要发送的数据为 101110。采用 CRC 的生成多项式是 P(X) = X<sup>3</sup> + 1。试求应添加在数据后面的余数

	**答：**

	做二进制出发 101110000 除以 1001 的余数为 011，因此添加在数据后面的余数为 011

3. 下图表示有五个站点分别连接在三个局域网上，并且用网桥 1 和网桥 2 连接起来。每一个网桥都有两个接口（1 和 2）。在一开始，两个网桥中的转发表都是空的。以后有以下各站向其他的站按先后顺序发送了数据帧：A 发送给 E，C 发送给 B，D 发送给 C，B 发送给 A。试把有关数据填写在下表中

	```
	        [ 网桥1 ]         [ 网桥2 ]
	  LAN1 1|      |2 LAN2  1|       |2   LAN3
	--+--+--+      +----+----+       +--+--+--
	  A  B              C               D  E
	```

	**答：**

	|发送的帧|网桥 1 的转发表（地址，接口）|网桥 2 的转发表（地址，接口）|网桥 1 的处理|网桥 2 的处理|
	|:---:|:---:|:---:|:---:|:---:|
	|A → E|A 1|A 1|转发，写入转发表|转发，写入转发表|
	|C → B|C 2|C 1|转发，写入转发表|转发，写入转发表|
	|D → C|D 2|D 2|写入转发表，丢弃不转发|转发，写入转发表|
	|B → A|B 1||写入转发表，丢弃不转发|接收不到这个帧|

## 第四章 网络层
### 网络层提供的两种服务
1. 虚电路服务

	**虚电路VC（Virtual Circuit）**，表示这只是一条逻辑上的连接，分组都沿着这条逻辑连接按照存储转发方式传送，而并不是真正建立了一条物理连接

2. 数据报服务

	网络层向上只提供简单灵活的、无连接的、尽最大努力交付的**数据报服务**

### 与 IP 协议配套使用的协议
1. 地址解析协议ARP（Address Resolution Protocol）

2. 网际控制报文协议ICMP（Internet Control Message Protocol）

3. 网际组管理协议IGMP（Internet Group Management Protocol）

### 不同层次的中间设备
|层次|中间设备名|
|:---:|:---:|
|物理层|转发器（repeater）|
|数据链路层|网桥或桥接器（bridge）|
|网络层|路由器（router）|
|网络层以上|网关（gateway）|

### IP 的分类
|类型|结构|前8位范围|
|:---|:---|:---|
|A 类地址|[{0:网络号}(8位):主机号(24位)]|0~127|
|B 类地址|[{10:网络号}(16位):主机号(16位)]|128~191|
|C 类地址|[{110:网络号}(24位):主机号(8位)]|192~223|
|D 类地址|[{1110:多播地址}(32位)]|224~239|
|E 类地址|[{1111:保留为今后使用}(32位)]|240~255|

### ICMP 报文的种类
1. ICMP 差错报告报文

2. ICMP 询问报文

### 内部网关协议 RIP
1. 定义

	**路由信息协议RIP（Routing Information Protocol）**是一种分布式的基于距离向量的路由选择协议

2. 特点

	- **仅和相邻路由器交换信息**

	- **路由器交换的信息是当前路由器所知道的全部信息，即自己的路由表**

	- **按固定的时间间隔来交换路由信息**

3. 距离向量算法

	（1）对地址为 X 的相邻路由器发来的 RIP 报文，先修改此报文中的所有项目：把“下一跳”字段中的地址都改为 X，并把所有的“距离”字段的值都加 1

	（2）对修改后的 RIP 报文中的每一个项目，进行以下的步骤：

		若原来的路由器表中没有目的网络 N，则把该项目添加到路由表中

		否则（即在路由表中有目的网络 N，这时就再查看下一跳路由器地址）

		若下一跳路由器地址是 X，则把收到的项目替换原路由表中的项目

		否则（即这个项目是：到目的网络 N，但下一跳路由器不是 X）

		若收到的项目中的距离 d 小于路由表中的距离，则进行更新，否则什么也不做

	（3）若 3 分钟还没收到相邻路由器的更新路由表，则把此相邻路由器记为不可达的路由器，即把距离置为 16（距离为 16 表示不可达）

	（4）返回

### 练习题
1. 试简单说明下列协议的作用：IP、ARP、RARP、ICMP

	**答：**

	（1）IP：实现网络互连。使参与互连的性能各异的网络从用户看起来好像是一个统一的网络。网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一，与 IP 协议配套使用的协议还有四个

	（2）ARP：是解决同一个局域网上的主机或路由器的 IP 地址和硬件地址的映射问题

	（3）RARP：是解决同一个局域网上的主机或路由器的硬件地址和 IP 地址的映射问题

	（4）ICMP：提供差错报告和询问报文，以提高 IP 数据交付成功的机会

2. 回答以下问题：

	（1）子网掩码为 255.255.255.0 代表什么意思？

	（2）一网络的现在掩码为 255.255.255.248，问该网络能够连接多少个主机？

	（3）一 A 类网络和一 B 类网络的子网号 subnet-id 分别为 16 个 1 和 8 个 1，问这两个网络的子网掩码有何不同？

	（4）一个 B 类地址的子网掩码是 255.255.240.0。试问在其中每一个子网上的主机数最多是多少？

	（5）一 A 类网络的子网掩码为 255.255.0.255，它是否为一个有效的子网掩码？

	（6）某个 IP 地址的十六进制表示是 C2.2F.14.81，试将其转换成为点分十进制的形式

	（7）C 类网络使用子网掩码有无实际意义？为什么？

	**答：**

	（1）有三种含义：1）表示 A 类网络的子网掩码，对于 A 类网络的 IP 地址，前 8 位表示网络号，后 24 为表示主机号，使用子网掩码 255.255.255.255.0 表示前 8 位为网络号，中间 16 位用于子网段的划分，最后 8 位为主机号；2）表示 B 类网络的子网掩码，对于 B 类网络的 IP 地址，前 16 位表示网络号，后 16 位表示主机号，使用子网掩码 255.255.255.0 表示前 16 位为网络号，中间 8 位用于子网段的划分，最后 8 位为主机号；3）表示 C 类网络的子网掩码，这个子网掩码为 C 类网络的默认子网掩码

	（2）255.255.255.248 即为 11111111.11111111.11111111.11111000，每一个子网上的主机为（2<sup>3</sup>-2）6台（除去全 0 和全 1 的两个地址）

	（3）A 类网络：11111111 11111111 11111111 00000000，给定子网号（16 位 1），则子网掩码为255.255.255.0；B 类网络：11111111 11111111 11111111 00000000，给定子网号（8 位 1），则子网掩码为255.255.255.0。虽然他们的子网掩码相同，但他们的子网数目不同

	（4）255.255.240.0 二进制表示为 11111111.11111111.11110000.00000000，即主机号有 4 + 8 = 12 位，因此，最大主机数为：2<sup>12</sup> - 2 = 4094 台

	（5）是一个有效的子网掩码

	（6）转换结果：11000010.00101111.00010100.10000001，是一个 C 类地址

	（7）有实际意义：C 类子网 IP 地址 32 位中，前 24 位用于确定网络号，后 8 位用于确定主机号，如果划分子网，可以选择后 8 位中的高位，这样做可以进一步划分网络，并且不增加路由表的内容，但是代价是主机数相应减少

3. 设某路由器建立了如下路由表：

	|目的网络|子网掩码|下一跳|
	|:---:|:---:|:---:|
	|128.96.39.0|255.255.255.128|接口 m<sub>0</sub>|
	|128.96.39.128|255.255.255.128|接口 m<sub>1</sub>|
	|128.96.40.0|255.255.255.128|R<sub>2</sub>|
	|192.4.153.0|255.255.255.192|R<sub>3</sub>|
	|*（默认）|-|R<sub>4</sub>|

	现在共收到 5 个分组，其目的地址分别为：

	（1）128.96.39.10

	（2）128.96.40.12

	（3）128.96.40.151

	（4）192.4.153.17

	（5）192.4.153.90

	试分别计算其下一跳

	**答：**

	（1）目的地址 128.96.39.10 与子网掩码 255.255.255.128 相与，得 128.96.39.0，可见该分组下一跳为接口m<sub>0</sub>

	（2）同理，得下一跳为 R<sub>2</sub>

	（3）同理，得下一跳为 R<sub>4</sub>

	（4）同理，得下一跳为 R<sub>3</sub>

	（5）同理，得下一跳为 R<sub>4</sub>

4. 一个数据报长度为 4000 字节（固定首部长度）。现在经过一个网络传送，但此网络能够传送的最大数据长度为 1500 字节。试问应当划分为几个短些的数据报片？各数据报片的数据字段长度、片偏移字段和 MF 标志应为何数值？

	**答：**

	|编号|总长度（字节）|数据字段长度（字节）|MF|片偏移|
	|:---:|:---:|:---:|:---:|:---:|
	|原始数据报|4000|3980|0|0|
	|数据报片1|1500|1480|1|0|
	|数据报片2|1500|1480|1|185|
	|数据报片3|1040|1020|0|370|

5. 假定网络中的路由器 B 的路由表有如下的项目：

	|目的网络|距离|下一跳|
	|:---:|:---:|:---:|
	|N<sub>1</sub>|7|A|
	|N<sub>2</sub>|2|C|
	|N<sub>6</sub>|8|F|
	|N<sub>8</sub>|4|E|
	|N<sub>9</sub>|4|F|

	现在 B 收到从 C 发来的路由信息：

	|目的网络|距离|
	|:---:|:---:|
	|N<sub>2</sub>|4|
	|N<sub>3</sub>|8|
	|N<sub>6</sub>|4|
	|N<sub>8</sub>|3|
	|N<sub>9</sub>|5|

	试求出路由器 B 更新后的路由表

	**答：**

	更新后的路由表如下：

	|目的网络|距离|下一跳|是否更新|
	|:---:|:---:|:---:|:---:|
	|N<sub>1</sub>|7|A|无新信息，不改变|
	|N<sub>2</sub>|5|C|相同的下一跳，更新|
	|N<sub>3</sub>|9|C|新的项目，添加进来|
	|N<sub>6</sub>|5|C|不同的下一跳，距离更短，更新|
	|N<sub>8</sub>|4|E|不同的下一跳，距离一样，不更新|
	|N<sub>9</sub>|4|F|不同的下一跳，距离更大，不更新|

## 第五章 运输层
### 运输层的两个主要协议
1. 用户数据报协议UDP（User Datagram Protocol）

2. 传输控制协议TCP（Transmission Control Protocol）

### 常见的端口号
|应用程序|熟知端口号|
|:---:|:---:|
|FTP|21|
|TELNET|23|
|SMTP|25|
|DNS|53|
|TFTP|69|
|HTTP|80|
|SNMP|161|
|SNMP(trap)|162|

### 练习题
1. 一 UDP 用户数据报的首部的十六进制表示是：06 32 00 45 00 1C E2 17。试求源端口、目的端口、用户数据报的总长度、数据部分长度。这个用户数据报是从客户端发送给服务器还是从服务器发送给客户？使用 UDP 的这个服务器程序是什么？

	**答：**

	源端口：06 32 转换成十进制为 1586

	目的端口：00 45 转换成十进制为 69

	UDP 用户数据报的总长度：00 1C 转换成十进制为 28 字节

	数据部分长度：28 - 8 = 20 字节

	此 UDP 用户数据报是从客户发给服务器（因为目的端口 < 1024，是熟知端口），服务器程序是 TFTP

2. 试计算一个包括五段链路的运输链接的单程端到端时延。五段链路程中有两段是卫星链路，有三段是广域网链路。每条卫星链路又由上行链路和下行链路两部分组成。可以取这两部分的传播时延之和为 250ms。每一个广域网的范围为 1500km，其传播时延可按 150 000km/s 来计算。各数据链路速率为 48kb/s，帧长为 960 位。

	**答：**

	（1）传播时延

	卫星时延：250 × 2 = 500ms

	广域网时延：1500 / 150 000 × 3 × 1000 = 30ms

	（2）发送时延

	960 / (48 × 1000) × 1000 × 5 = 100ms

	综上，总时延为 500 + 100 + 30 = 630ms

3. TCP 的拥塞窗口 cwnd 大小与传输伦次 n 的关系如下所示：

	|cwnd|1|2|4|8|16|32|33|34|35|36|37|38|39|
	|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
	|n|1|2|3|4|5|6|7|8|9|10|11|12|13|

	|cwnd|40|41|42|21|22|23|24|25|26|1|2|4|8|
	|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
	|n|14|15|16|17|18|19|20|21|22|23|24|25|26|

	（1）试画出拥塞窗口与传输轮次的关系曲线

	（2）指明 TCP 工作在慢开始阶段的时间间隔

	（3）指明 TCP 工作在拥塞避免阶段的时间间隔

	（4）在第 16 轮次和第 22 轮次之后发送方是通过收到三个重复的确认还是通过超时检测到丢失了报文段？

	（5）在第 1 轮次、第 18 轮次和第 24 轮次发送时，门限 ssthresh 分别被设置为多大？

	（6）在第几轮次发送出第 70 个报文段

	（7）假定在第 26 轮次之后收到了三个重复的确认，因而检测出了报文段的丢失，那么拥塞窗口 cwnd 和门限 ssthresh 应设置为多大？

	**答：**

	（1）略（Markdown不支持画折线图，无能为力）

	（2）慢开始时间间隔：[1, 6]，[23, 26]

	（3）拥塞避免时间间隔：[6, 16]，[17, 22]

	（4）在第 16 轮次是收到三个重复的确认，第 22 轮次是检测到丢失了报文段

	（5）第 1 轮次为 32；第 18 轮次为 21；第 24 轮次为 13

	（6）第 7 轮次

	（7）拥塞窗口 cwnd 和门限 ssthresh 应设置为 8 的一半，即 4

## 第六章 应用层
### 域名系统 DNS
**域名系统DNS（Domain Name System）**是因特网使用的命名系统，用来把便于人们使用的机器名字转换成 IP 地址

### 统一资源定位符 URL
**统一资源定位符 URL** 是用来表示从因特网上得到的资源位置和访问这些资源的方法

一般形式为：

```
<协议>://<主机>:<端口>/<路径>
```
