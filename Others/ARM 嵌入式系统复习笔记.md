# ARM 嵌入式系统复习笔记
## 1. 什么是嵌入式系统？试举出一些生活中常见的例子
嵌入式系统源于**微型计算机**，是嵌入到对象体系中，实现嵌入对象智能化的计算机

生活中常见的例子：MP3、DVD、DV、打印机、DC、PDA、ADSL、手机

## 2. 嵌入式系统的特点
1. 低消耗

2. 低成本

3. 多速率

4. 环境相关性

5. 系统内核小

6. 专用性强

## 3. 嵌入式系统的三个基本要素
1. 嵌入性

	“嵌入性”专指计算机嵌入到对象体系中，实现对象体系的智能控制

2. 内含计算机

	“内含计算机”是对象系统智能化控制的根本保证

3. 专用性

	“专用性”是指在满足对象控制要求及环境要求下的软硬件裁剪性
	
## 4. 嵌入式处理器是怎样分类的
1. 一类嵌入式处理器注重尺寸、能耗和价格

2. 另一类嵌入式处理器更关注性能

3. 还有一类嵌入式处理器关注全部 4 个需求――性能、尺寸、能耗和价格
	
## 5. 常见的嵌入式系统有哪几类？分别是什么？各有什么特点？
1. 嵌入式微处理器（Embedded Microprocessor Unit，EMPU）

	嵌入式微处理器的基础是通用计算机中的 CPU
	
	特点：体积小、重量轻、成本低、可靠性高、技术保密性较差

2. 微控制器（Microcontroller Unit，MCU）

	微控制器又称**单片机**，就是将整个计算机系统集成到一块芯片中。
	
	特点：单片化，体积大大减小，从而使功耗和成本下降，可靠性提高

3. DSP 处理器（Digital Signal Processor，DSP）

	DSP 处理器对系统结构和指令进行了特殊设计，使其适合于执行 DSP 算法
	
	特点：编译效率较高，指令执行速度也较高

4. 片上系统（System on Chip，SoC）

	Soc 就是在一个硅片上实现一个复杂的系统
	
	特点：应用系统电路板简洁、体积小、功耗低、可靠性高
	
## 6. ARM 微处理器有哪几种工作状态？是怎样定义的？各状态下的指令长度？
1. ARM 状态：指令长度 32 位，处理器执行字方式的 ARM 指令，处理器在系统上电时默认为 ARM 状态

2. Thumb 状态：指令长度 16 位，处理器执行半字方式的 Thumb 指令

## 7. ARM 处理器有哪几种工作模式？分别是什么？
|处理器模式|说明|备注|
|:---|:---|:---|
|用户（usr）|正常程序运行的工作模式|不能直接从用户模式切换到其他模式|
|系统（sys）|用于支持操作系统的特权任务等|与用户模式类似，但具有直接切换到其他模式等特权|
|管理（svc）|供操作系统使用的一种保护模式|只有在系统复位和软件中断响应时，才进入此模式|
|中止（abt）|用于虚拟内存和（或）存储器保护|在 ARM7 内核中没有多大用处|
|未定义（und）|支持软件仿真的硬件协处理器|只有在未定义指令异常响应时，才进入此模式|
|中断（irq）|中断请求处理|只有在 IRQ 异常响应时，才进入此模式|
|快速中断（fiq）|快速中断请求处理|只有在 FIQ 异常响应时，才进入此模式|

## 8. ARM 微处理器支持哪几种数据类型
1. Byte，字节，8 位

2. Halfword，半字，16 位

3. Word，字，32位

## 9. ARM 状态下有多少个寄存器？简述 R13，R14，R15，CPSR 和 SPSR 的一般用途
ARM 状态下有 18 个寄存器

- R13：堆栈指针 SP，用于保存堆栈的出入口处地址

- R14：链接寄存器 LR，子程序的返回地址将自动地存入到 R14 中

- R15：程序计数器 PC，总是指向正在“取指”的指令

- CPSR：程序状态寄存器，ARM 内核就是通过使用 CPSR 来监视系统和控制内部操作的

- SPSR：在异常模式中，允许访问用于保存 CPSR 当前值的备份程序状态寄存器 SPSR

## 10. 分别列出 ARM 处理器的 5 种异常模式下的专用寄存器
1. 管理：R13_svc、R14_svc、SPSR_svc

2. 中止：R13_abt、R14_abt、SPSR_abt

3. 未定义：R13_und、R14_und、SPSR_und

4. 中断：R13_irq、R14_irq、SPSR_irq

5. 快速中断：R13_fiq、R14_fiq、SPSR_fiq

## 11. ARM 处理器有哪些异常类型？各个异常的优先级分别是？
|优先级|异常|
|:---:|:---:|
|1|复位|
|2|数据中止|
|3|FIQ|
|4|IRQ|
|5|预取指中止|
|6|未定义指令|
|6|软件中断 SWI|

## 12. 说明异常响应的过程
1. 将异常处理程序的返回地址保存到相应异常模式下的 LR，异常处理程序完成后的返回可通过将 LR 的值减去偏移量后写入 PC

2. 将 CPSR 的当前值保存到相应异常模式下的 SPSR，异常处理程序完成后的返回可通过保存在 SPSR 中的值来恢复 CPSR

3. 设置 CPSR 为相应的异常模式

4. 设置 PC 为相应异常处理程序的中断入口向量地址，跳转到相应的异常中断处理程序执行
	
## 13. 说明异常返回的过程
1. 返回到发生异常中断的指令的下一条指令处执行，也就是说，将 LR 中的值减去偏移量后移入 PC，偏移量根据异常的类型而有所不同

2. 将 SPSR 的值复制回 CPSR

3. 在入口处置位的中断禁止控制位清零

## 14. 什么是异常向量？列出各种异常向量
异常向量：每种处理器操作模式都有一个相关联的中断向量，当一个异常发生时，ARM 将会改变模式，而程序计数器 PC 将会被强行指向异常向量

|地址|异常|进入时的模式|进入时 I 的状态|进入时 F 的状态|
|:---:|:---:|:---:|:---:|:---:|
|0x0000 0000|复位|管理|禁止|禁止|
|0x0000 0004|未定义指令|未定义|I|F|
|0x0000 0008|软件中断|管理|禁止|F|
|0x0000 000C|中止（预取）|中止|I|F|
|0x0000 0010|中止（数据）|中止|I|F|
|0x0000 0014|保留|保留|-|-|
|0x0000 0018|IRQ|中断|禁止|F|
|0x0000 001C|FIQ|快速中断|禁止|禁止|

## 15. 有哪几种转移指令，并说明每种转移指令的功能？
1. B――分支指令：跳转到指定的地址去执行程序

2. BL――带链接的分支指令：BL 指令先将下一条指令的地址复制到 R14（即 LR）链接寄存器中，然后跳转到指定地址，运行程序

3. BX――带状态切换的分支指令：BX 指令跳转到 Rm 指定的地址去执行程序。若 Rm 的 bit0 为 1，则跳转时自动将 CPSR 中的标志 T 置位，即把目标地址的代码解释为 Thumb 代码；若 Rm 的 bit0 为 0，则跳转时自动将 CPSR 中的标志 T 复位，即把目标地址的代码解释为 ARM 代码

## 16. 说明转移指令“B L1”中的标号 L1，在当前指令的什么范围内有效
在当前指令的 ±32MB 地址范围内（ARM 指令为字对齐，最低 2 位地址固定为 0）有效

## 17. 说明转移指令“BX R0”的转移范围，R0 取何值可转移到 ARM 指令处、R0 取何值可转移到 Thumb 指令处
BX 指令跳转到 R0 指定的地址去执行程序。R0 的 bit0 为 1 时，转移到 Thumb 指令处，R0 的 bit0 为 0 时，转移到 ARM 指令处

## 18. 判断指令的正误
|指令|正误|
|:---|:---|
|LDR R1, [R2, R5]!|正确|
|STR R2, [R3], #0xFFFF8|错误，超出了立即数的范围|
|STREQ R4, [R0, R4, LSL R5]|错误，不能用寄存器表示移位的位数|
|LDR R4, [R0, R1, LSL #32]|错误，超出了移位的范围|
|STREQ R3, [R6], #-0x08|正确|
|LDR R0, [R2]!, -R6|错误，后索引不用`!`后缀|
|LDR R4, START|正确|
|LDR R1, [SP, #-0x04]|正确|
|STR R1, START|格式正确，但要保证标号处可以存储数据|
|LDR PC, R6|错误，R6 不表示一个存储地址|
|LDR PC, [R6]|正确|
|LDR R1, [R3, R15]|错误，R15 不可作为偏移寄存器|
|MUL R1, R1, R6|错误，目标寄存器 R1 不能同时做第 1 操作数|
|MUL R1, R6, [R5]|错误，不能使用`[]`|
|MLA R4, R5, R6|错误，少一个操作数|
|MULSNE R6, R3, R0|错误，应该书写成`MULNES`|
|UMLAL R6, R4, R4, R1|错误，R4 不能同时做 Rdlo、Rdhi|
|SMULL R5, R3, R0|错误，少一个操作数|
|MUL R2, R5, #0x20|错误，不可用立即数|

## 19. 如何定义一个代码段？如何定义一个数据段？代码段与数据段各有什么属性？
1. 代码段
	通常是指用来存放程序执行代码的一块内存区域。这部分区域的大小在程序运行前就已经确定，并且内存区域通常属于只读,某些架构也允许代码段为可写，即允许修改程序
	
2. 数据段

	通常是指用来存放程序中已初始化的全局变量的一块内存区域。数据段属于静态内存分配

## 20. 如何说明指令是Thumb指令还是ARM指令？
1）ARM指令：指令集支持ARM核所有的特性，具有高效、快速的特点。ARM指令集效率高，但是代码密度低，所有的ARM指令都是可以有条件执行的
2）Thumb指令：指令集具有较高的代码密度，却仍然保持ARM的大多数性能上的优势，它是ARM指令集的子集，指令集具有灵活、小巧的特点。Thumb指令仅有一条指令具备条件执行功能。
ARM程序和Thumb程序可相互调用，CPSR[T]可以反映处理器当前所处的状态，相互之间的状态切换开销几乎为零

## 21. ARM指令系统包含哪几类指令？为每类指令举出一个例子
1）存储器访问指令：LDR R1, [R0]
2）ARM数据处理指令：CMP R1, #19
3）乘法指令：MUL R1, R2, R3
4）ARM分支指令：B 0x1234
5）杂项指令（软件中断、读状态寄存器、写状态寄存器）：SWI 0
6）ARM伪指令：ADR R2, LOOP

## 22. 阐述嵌入式系统与物联网之间的联系（阐述嵌入式系统在物联网中的应用），至少包含四点
1）rfid与嵌入式系统。感知层是物联网中的重要的感知节点，它融合了传感技术、嵌入式技术等
2）产品电子编码epc。epc是目前比较典型的物联网应用体系结构
3）电子商务、物流管理。针对目前的物流企业、商店等，通过一些小、中型嵌入式设备，很方便地完成商品信息的录入、获取等功能
4）自动控制。ATM机、自动售货机等产品的使用

## 23. 结合嵌入式系统的应用，简要分析嵌入式系统的应用现状和未来趋势
1）现状

	（1）自动控制：ATM机、自动售票机等产品的广泛应用
	（2）汽车智能化：嵌入式系统与汽车进行集成，大大增加了汽车的智能化程度
	（3）电力系统管理：很多无人值班的变电站都是利用嵌入式系统来实现
	
2）未来

	（1）系统工程化：嵌入式开发是一项系统工程，因此需要软硬件的同时支持
	（2）功能多样化：随着技术的成熟，嵌入式系统的功能必将更加丰富
	（3）网络化：随着网络的进步，新一代的嵌入式设备已经开始适配各种各样的网络
	（4）简化系统内核、降低功耗、降低成本：随着科技的进步，这些优化都是必然的趋势
	（5）交互友好化：未来嵌入式系统需要更高的可交互性和高度抽象化
